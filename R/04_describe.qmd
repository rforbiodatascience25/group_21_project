
```{r}
#| warning: false
#| message: false

library("tidyverse")
library("cowplot")
library("broom")
library("table1")
library("ggplot2")
```

```{r}
#| warning: false
#| message: false

augmented_table <- read_tsv("../data/03_augmented_table.tsv")
augmented_metadata <- read_tsv("../data/03_augmented_metadata.tsv")
PCA_ready_table <- read_tsv("../data/03_augmented_table_PCA.tsv")
```

```{r}
augmented_metadata_table <- augmented_metadata |>
  mutate(Gender = factor(Gender),
         Cohort = factor(Batch)) |>
  table1(x = formula(~ Gender + Age + Localisation + TLS_status | IDH_status),
         data = _)

htmltools::save_html(augmented_metadata_table, "../results/IDH_status_table.html")
```

```{r}
augmented_metadata_table2 <- augmented_metadata |>
  mutate(Gender = factor(Gender),
         Cohort = factor(Batch)) |>
  table1(x = formula(~ Gender + Age + Localisation + IDH_status | TLS_status),
         data = _)

htmltools::save_html(augmented_metadata_table2, "../results/TLS_status_table.html")
```

# CLEAN:

We are doing the principle componant analysis of the augmented data.

```{r}
pca_fit <- PCA_ready_table |> 
  select(where(is.numeric)) |> 
  select(!c(GEP_score, Age, Batch)) |>
  prcomp(scale = TRUE)

pca_for_plots <- pca_fit |> 
  augment(PCA_ready_table)
```

First we take a look at the first two PCs 

```{r}
pca_tls <- pca_for_plots |>
  ggplot(aes(.fittedPC1, .fittedPC2, color = TLS_status, fill = TLS_status)) + 
  geom_point(size = 1.8, alpha=1, shape = 21) +
  scale_fill_manual(
    values = c(
      TLS    = "indianred3",
      control = "lightsteelblue2"
    )
  ) +
  scale_color_manual(
    values = c(
      TLS    = "indianred4",
      control = "lightsteelblue3"
    )
  ) +
  theme_half_open(12) + background_grid() +
  labs(title = "The first two PCs of transcription data, startified by TLS status",
       x = "PC1",
       y = "PC2")
pca_tls
ggsave(filename = "../results/TLS_status_PCA.png", plot = pca_tls, device = "png", bg = "white")
```

```{r}
pca_idh <- pca_for_plots |>
  ggplot(aes(.fittedPC1, .fittedPC2, color = IDH_status, fill = IDH_status)) + 
  geom_point(size = 1.8, alpha=1, shape = 21) +
  scale_fill_manual(
    values = c(
      IDH_mutant    = "indianred3",
      IDH_wild_type = "lightsteelblue2"
    )
  ) +
  scale_color_manual(
    values = c(
      IDH_mutant    = "indianred4",
      IDH_wild_type = "lightsteelblue3"
    )
  ) +
  theme_half_open(12) + background_grid() +
  labs(title = "The first two PCs of transcription data, startified by IDH status",
       x = "PC1",
       y = "PC2")
pca_idh
ggsave(filename = "../results/IDH_status_PCA.png", plot = pca_idh, device = "png", bg = "white")
```

